<div class="max-w-4xl mx-auto mt-8 bg-white rounded-lg shadow-md overflow-hidden">
  <div class="px-6 py-4 bg-primary-600 text-white">
    <h2 class="text-xl font-semibold">Compose Email</h2>
  </div>

  <div class="p-6">
    <form [formGroup]="emailForm" class="space-y-4">
      <!-- To field -->
      <div>
        <label for="to" class="label">To:</label>
        <input
          id="to"
          type="email"
          formControlName="to"
          class="input w-full"
          placeholder="recipient@example.com"
        >
        <p *ngIf="emailForm.get('to')?.invalid && emailForm.get('to')?.touched"
           class="text-red-500 text-sm mt-1">
          Valid email address is required
        </p>
      </div>

      <!-- CC field -->
      <div>
        <label for="cc" class="label">CC:</label>
        <input
          id="cc"
          type="text"
          formControlName="cc"
          class="input w-full"
          placeholder="cc@example.com"
        >
      </div>

      <!-- BCC field -->
      <div>
        <label for="bcc" class="label">BCC:</label>
        <input
          id="bcc"
          type="text"
          formControlName="bcc"
          class="input w-full"
          placeholder="bcc@example.com"
        >
      </div>

      <!-- Subject field -->
      <div>
        <label for="subject" class="label">Subject:</label>
        <input
          id="subject"
          type="text"
          formControlName="subject"
          class="input w-full"
          placeholder="Email subject"
        >
        <p *ngIf="emailForm.get('subject')?.invalid && emailForm.get('subject')?.touched"
           class="text-red-500 text-sm mt-1">
          Subject is required
        </p>
      </div>
      <!-- Add this field after the Subject field -->
<div>
  <label for="senderName" class="label">Sender Name:</label>
  <input
    id="senderName"
    type="text"
    formControlName="senderName"
    class="input w-full"
    placeholder="Your Name (or Company Name)"
  >
  <p class="text-sm text-gray-500 mt-1">
    Special characters are allowed (e.g., John Doe @ Company Inc.)
  </p>
</div>

      <!-- HTML Editor -->
      <div>
        <label class="label">Email Content:</label>

        <!-- Code block checkbox only -->
        <div class="mb-2 flex justify-end">
          <div class="flex items-center">
            <input
              type="checkbox"
              id="codeBlockMode"
              class="mr-2 h-4 w-4 text-blue-600 rounded focus:ring-blue-500"
              [(ngModel)]="isCodeBlockMode"
              [ngModelOptions]="{standalone: true}">
            <label for="codeBlockMode" class="text-sm text-gray-700">
              Format as Code Block
            </label>
          </div>
        </div>

        <app-html-editor
          [content]="emailForm.get('html')?.value"
          (contentChange)="emailForm.get('html')?.setValue($event)"
        ></app-html-editor>

        <p *ngIf="emailForm.get('html')?.invalid && emailForm.get('html')?.touched"
           class="text-red-500 text-sm mt-1">
          Email content is required
        </p>
      </div>

      <!-- Attachments -->
      <div>
        <label class="label">Attachments:</label>
        <div class="flex items-center space-x-2">
          <input
            type="file"
            id="fileUpload"
            class="hidden"
            (change)="onFileSelected($event)"
          >
          <label
            for="fileUpload"
            class="btn btn-secondary cursor-pointer flex items-center"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
            </svg>
            Add Attachment
          </label>
        </div>

        <div *ngIf="attachments.length > 0" class="mt-2 space-y-1">
          <div *ngFor="let attachment of attachments" class="flex items-center justify-between p-2 bg-gray-50 rounded">
            <span class="text-sm">{{ attachment.originalname }}</span>
            <button
              type="button"
              (click)="removeAttachment(attachment.filename)"
              class="text-red-500 hover:text-red-700"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Action buttons -->
<!-- Add this button in the action buttons section -->
<div class="flex justify-between pt-4">
  <!-- Left side buttons -->
  <div class="space-x-2">
    <button
      type="button"
      (click)="onSaveDraft()"
      class="btn btn-secondary"
      [disabled]="isLoading"
    >
      <span *ngIf="!isLoading">Save Draft</span>
      <span *ngIf="isLoading">Saving...</span>
    </button>

    <!-- New Preview Button -->
    <button
      type="button"
      (click)="previewEmail()"
      class="btn btn-outline-primary"
      [disabled]="emailForm.invalid || isLoading"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
      </svg>
      Preview
    </button>
  </div>

  <!-- Send button -->
  <button
    type="button"
    (click)="onSendEmail()"
    class="btn btn-primary"
    [disabled]="emailForm.invalid || isLoading"
  >
    <span *ngIf="!isLoading">Send Email</span>
    <span *ngIf="isLoading">Sending...</span>
  </button>
</div>

<!-- Add preview modal (conditionally displayed) -->
<app-html-preview-modal
  *ngIf="showPreview"
  [html]="previewHtml"
  [subject]="emailForm.get('subject')?.value"
  (close)="closePreview()"
></app-html-preview-modal>
    </form>
  </div>
</div>
